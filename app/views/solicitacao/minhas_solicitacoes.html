{% extends 'layouts/layout.html' %}

{% block content %}
<div class="content-wrapper">
    <main class="container">
        <h1>Minhas Solicitações</h1>

        <form class="formulario-filtros" method="GET" action="/">
            <label for="status_filter" style="font-weight: bold;">Filtrar por Status:</label>
            <select name="status" id="status_filter" onchange="this.form.submit()" style="padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
                <option value="" {% if not filtro_ativo %}selected{% endif %}>Todos</option>
                <option value="Pendente" {% if filtro_ativo == 'Pendente' %}selected{% endif %}>Pendente</option>
                <option value="Em Análise" {% if filtro_ativo == 'Em Análise' %}selected{% endif %}>Em Análise</option>
                <option value="Agendada" {% if filtro_ativo == 'Agendada' %}selected{% endif %}>Agendada</option>
                <option value="Em Andamento" {% if filtro_ativo == 'Em Andamento' %}selected{% endif %}>Em Andamento</option>
                <option value="Concluída" {% if filtro_ativo == 'Concluída' %}selected{% endif %}>Concluída</option>
                <option value="Cancelado" {% if filtro_ativo == 'Cancelado' %}selected{% endif %}>Cancelado</option>
            </select>
        </form>

        <div class="table-responsive">
            <table id="tabela-solicitacoes" class="display"> 
                <thead>
                    <tr>
                        <th>Protocolo</th>
                        <th>Categoria</th>
                        <th>Endereço</th>
                        <th>Status</th>
                        <th>Data Agendada</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                
                <tbody>
                    {% for s in solicitacoes %}
                    <tr>
                        <td>#{{ s.id }}</td>
                        <td>{{ s.categoria }}</td>
                        <td>{{ s.endereco }}</td>
                        <td>
                            {% if s.status == 'Pendente' %}<span class="status-pill status-pendente">Pendente</span>
                            {% elif s.status == 'Em Análise' %}<span class="status-pill status-em-analise">Em Análise</span>
                            {% elif s.status == 'Agendada' %}<span class="status-pill status-agendada">Agendada</span>
                            {% elif s.status == 'Em Andamento' %}<span class="status-pill status-em-andamento">Em Andamento</span>
                            {% elif s.status == 'Concluída' %}<span class="status-pill status-concluida">Concluída</span>
                            {% elif s.status == 'Cancelado' %}<span class="status-pill status-cancelado">Cancelado</span>
                            {% else %}{{ s.status }}
                            {% endif %} </td>
                        <td>
                           {% if s.data_agendamento %}
                                {{ s.data_agendamento.strftime('%d/%m/%Y') }}
                            {% else %}
                                Não agendada
                            {% endif %}
                        </td>
                        <td class="actions">
                            <a class="acoes view"><i class="fa-solid fa-eye"></i></a>
                        </td>
                    </tr>
                {% endfor %}  
                </tbody>
            </table>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script text="type/javascript">

    $(document).ready(function() {

        $('#tabela-solicitacoes').DataTable({
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/pt-BR.json', 
            }
        })

    })

</script>
{% endblock %}